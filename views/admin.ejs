<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Sales Leaders - Admin</title>
		<link rel='stylesheet' href='/stylesheets/admin.css' />
	</head>
	<body>
		<h1><a href="/">Sales Leaders</a> administration</h1>

		<form method="POST">

			<input type="Submit" value="save" />

			<% var personIndex = 0; %>

			<% _.forEach(["quarter", "month"], function(period, periodIndex){ %>

				<% if(periodIndex){ %>
					<a href="#" class="copyValuesTo <%= period %>">&#8595; copy everything to <%= period %> &#8595;</a>
				<% } %>

				<div class="period <%= period %>">

					<h2><%= period %></h2>
					<ol>

					<% _(people).where({ period: period }).sortBy('rank').forEach(function(person){ %>
						<li class="person">
							<% personIndex++; %>

							<%- hidden_field_tag('people['+personIndex+'][period]', period) %>

							<label class="name">
								<span>Name</span>
								<%- text_field_tag('people['+personIndex+'][name]', {
									value: person.name }) %>
							</label>

							<label class="quota">
								<span>Quota</span>
								<%- text_field_tag('people['+personIndex+'][quota]', {
									value: Math.round(person.quota*100),
									pattern: '^\\d+$' }) %>%
							</label>

							<label class="acv">
								<span>ACV</span>
								$<%- text_field_tag('people['+personIndex+'][acv]', {
									value: Math.round(person.acv/1000),
									pattern: '^[\\d\\.]+$' }) %>K
							</label>
						</li>
					<% }); %>

					</ol>

				</div>



			<% }); %>

			<input type="Submit" value="save" />

			<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
			<script type="text/javascript">
				$(function(){

					$('.copyValuesTo').each(function(){
						var copyValuesLink = $(this);

						copyValuesLink.click(function(event){
							event.preventDefault();
							var originPeriodDiv = copyValuesLink.prev('.period');
							var destinationPeriodDiv = copyValuesLink.next('.period');

							var originTextFields = originPeriodDiv.find('input[type=text]');
							var destinationTextFields = destinationPeriodDiv.find('input[type=text]');

							for(var fieldIndex = 0; fieldIndex < originTextFields.length; fieldIndex++){
								var valueToCopy = $(originTextFields.get(fieldIndex)).val();
								// console.log("copying value "+value);
								$(destinationTextFields.get(fieldIndex)).val(valueToCopy);
							}
						});
					});
				});
			</script>

		</form>
	</body>
</html>